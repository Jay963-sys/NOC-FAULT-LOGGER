<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>NOC Fault Logger - Admin Dashboard</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <header>
      <h1>NOC Fault Logger - Admin Dashboard</h1>
    </header>

    <div class="d-flex justify-content-between align-items-center mb-3">
      <h2>Admin Dashboard</h2>
      <div>
        <a href="{{ url_for('main.log_fault') }}" class="btn btn-primary"
          >Log New Fault</a
        >
        <a href="{{ url_for('main.customers') }}" class="btn btn-secondary"
          >Manage Customers</a
        >
        <a href="{{ url_for('main.departments') }}" class="btn btn-secondary"
          >Manage Departments</a
        >
      </div>
    </div>

    <div class="row mb-3">
      <div class="col-md-4 d-flex">
        <input
          type="text"
          id="searchInput"
          class="form-control me-2"
          placeholder="Search by Name, Circuit ID or Customer ID"
        />
        <button id="searchBtn" class="btn btn-primary">Search</button>
      </div>
      <div class="col-md-2">
        <select id="monthFilter" class="form-select">
          <option value="">All Months</option>
          <option value="1">January</option>
          <option value="2">February</option>
          <option value="3">March</option>
          <option value="4">April</option>
          <option value="5">May</option>
          <option value="6">June</option>
          <option value="7">July</option>
          <option value="8">August</option>
          <option value="9">September</option>
          <option value="10">October</option>
          <option value="11">November</option>
          <option value="12">December</option>
        </select>
      </div>
      <div class="col-md-2">
        <select id="yearFilter" class="form-select">
          <option value="">All Years</option>
          {% for y in range(2023, 2031) %}
          <option value="{{ y }}">{{ y }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-2">
        <button id="applyFilters" class="btn btn-primary w-100">Apply</button>
      </div>
    </div>

    <div class="tabs">
      <button class="tab active" data-filter="all">All Faults</button>
      <button class="tab" data-filter="Open">Open</button>
      <button class="tab" data-filter="In Progress">In Progress</button>
      <button class="tab" data-filter="Resolved">Resolved</button>
      <button class="tab" data-filter="Closed">Closed</button>
    </div>

    <div class="table-container">
      <table id="faultsTable">
        <thead id="tableHeader">
          <!-- Dynamic table headers inserted by script.js -->
        </thead>
        <tbody id="faultsTableBody">
          <!-- Table body loaded dynamically by script.js -->
        </tbody>
      </table>
    </div>

    <div id="drawer" class="drawer">
      <div class="drawer-header">
        <h2>Customer Details & History</h2>
        <button id="closeDrawer">&times;</button>
      </div>
      <div class="drawer-content">
        <div class="drawer-tabs">
          <button class="drawer-tab active" data-tab="details">
            Customer Details
          </button>
          <button class="drawer-tab" data-tab="history">Fault History</button>
        </div>
        <div id="detailsTab" class="tab-content active">
          <p><strong>Company:</strong> <span id="customerCompany"></span></p>
          <p><strong>IP Address:</strong> <span id="customerIP"></span></p>
          <p><strong>POP Site:</strong> <span id="customerPOP"></span></p>
          <p><strong>Circuit ID:</strong> <span id="customerCircuit"></span></p>
          <p><strong>Email:</strong> <span id="customerEmail"></span></p>
          <p><strong>Switch Info:</strong> <span id="customerSwitch"></span></p>
        </div>
        <div id="historyTab" class="tab-content">
          <table>
            <thead>
              <tr>
                <th>Fault ID</th>
                <th>Issue</th>
                <th>Status</th>
                <th>Date</th>
              </tr>
            </thead>
            <tbody id="faultHistoryBody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal">
      <div class="modal-content">
        <span id="closeEditModal" class="close">&times;</span>
        <h2>Edit Fault</h2>
        <form id="editFaultForm">
          <input type="hidden" id="editFaultId" />
          <label>Type:</label>
          <input type="text" id="editType" required />
          <label>Description:</label>
          <textarea id="editDescription" required></textarea>
          <label>Location:</label>
          <input type="text" id="editLocation" required />
          <label>Owner of Ticket:</label>
          <input type="text" id="editOwner" required />
          <label>Assigned To (Staff):</label>
          <input type="text" id="editAssignedTo" required />
          <button type="submit" class="btn btn-primary">Save Changes</button>
        </form>
      </div>
    </div>

    <div class="chart-container">
      <canvas id="deptChart"></canvas>
    </div>
    <div class="chart-container">
      <canvas id="dateChart"></canvas>
    </div>
    <div class="chart-container">
      <canvas id="severityChart"></canvas>
    </div>

    <script>
      window.chartData = {
        deptLabels: {{ chart_data["dept_labels"] | tojson | safe }},
        deptValues: {{ chart_data["dept_values"] | tojson | safe }},
        dateLabels: {{ chart_data["date_labels"] | tojson | safe }},
        dateValues: {{ chart_data["date_values"] | tojson | safe }},
        severityLabels: {{ severity_chart_data["labels"] | tojson | safe }},
        severityValues: {{ severity_chart_data["values"] | tojson | safe }}
      };
    </script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
  </body>
</html>
